# 滑动窗口协议

## Go-Back-N 协议

### 软件设计

### 结果分析

## Selective Repeat 协议

### 软件设计

### 结果分析

## 研究性讨论

### 10.1 CRC 校验能力

- 假设本次实验中所设计的协议用于建设一个通信系统。这种“在有误码的信道上实现无差错传输”的功能听起来很不错, 但是后来该用户听说CRC校验理论上不可能100%检出所有错误。这的确是事实, 你怎样说服他相信你的系统能够实现无差错传输？

  - 长L bit的校验和可以取 $2^L$ 个值, 含有它的信息包含没有被检出错误的概率为 $\frac{1}{2^L}$, 即任何随机差错被检出的概率都是 $1-\frac{1}{2^L}$。对CRC-32来说, 由于校验和长度为32bit, 对全部类型的差错可以达到99.9999%的检测率; 此外, 在一些特定情形下, CRC可以达到100%的检出率。对CRC-32来说, 它可以百分百检出以下差错类型：

    - 有一位错的信息

    - 有两位差错的信息

    - 有奇数个位差错的信息

    - 有和校验和一样长的突发差错的信息

  - 证明：

    对多项式 $s(D)$ 使用阶为 $L$ 的生成多项式 $g(D)$ 做带余除法, 记商式为 $z(D)$, 余式 $c(D)$ 可以被表示为
    $$
    \tag{10.1.1}
    s(D)D^L = g(D)z(D) + c(D)
    $$
    两边同时减去 $c(D)$ (模2) 且注意到模2减法和模2加法是等价的, 我们有
    $$
    \tag{10.1.2}
    x(D) = s(D)D^L + C(D) = g(D)z(D)
    $$
    可以看到所有的合法码字都可以被 $g(D)$ 整除, 且所有可以被 $g(D)$ 整除的多项式都是合法码字。

    现在假设 $x(D)$ 被传输, 接收方收到的序列被表示为多项式 $y(D)$, 因为传输的时候出现了差错, $x(D)$ 和 $y(D)$ 不完全一致。如果将差错序列表示为多项式 $e(D)$, 则有 $y(D) = x(D) + e(D)$, $+$ 指模2加法。帧中的每个差错都可以表示为 $e(D)$ 中对应位置的系数。在接收方, 余式为 $\left[\frac{y(D)}{g(D)}\right]$。由于 $x(D)$ 可以被 $g(D)$ 整除,所以有
    $$
    \tag{10.1.3}
    Remainder \left[\frac{y(D)}{g(D)}\right] = Remainder \left[\frac{e(D)}{g(D)}\right]
    $$
    如果没有差错产生,则 $e(D) = 0$, 上述余式为0。接收方遵循着这样的规则：当差错检测得到的余式为0的时候,认为收到的信息是无差错的;反之则认为是有差错的。当差错发生时 $[i.e., e(D) \neq 0]$, 仅当这个余式为0的时候接收方才会无法检测出差错。这种情况仅当 $e(D)$ 本身也是某个合法码字的时候才会发生。也就是说, $e(D) \neq 0$ 当且仅当存在非零多项式 $z(D)$, 使得
    $$
    \tag{10.1.4}
    e(D) = g(D)z(D)
    $$
    的情况下才是无法检测的。接下来进一步研究在什么情况下,无法检测的差错会出现。

    首先, 假设出现在一位差错 $e_i = 1$, 则有 $e(D) = D^i$。由于 $g(D)$ 有至少两个非零项 $(i.e., D^L 和 1)$, 对任意非零的 $z(D)$, $g(D)z(D)$ 都必有至少两个非零项。因此 $g(D)z(D)$ 不可能等于 $D^i$。由于对任意i都成立, 故所有的一位错误都可以被检测到, 即所有**有一位差错的信息都可以被检出**。类似的, 由于 $g(D)$ 中最高阶和最低阶相差 $L$ $(i.e., D^L 和 1, 相对的)$, 对所有非零的 $z(D)$, $g(D)z(D)$ 的最高阶项和最低阶项相差至少 $L$。因此, **如果 $e(D)$ 是合法码字, 那么突发错误的长度必须为至少 $L+1$** (突发错误长度为从第一个错误到最后一个错误(包括自身在内)的长度)。

    其次, 假设出现了两个差错, 分别在位置 $i$ 和 $j$, 则有
    $$
    \tag{10.1.5}
    e(D) = D^i + D^j = D^j(D^{i-j}+1),i>j
    $$
    根据前面的讨论, $D^j$ 不能被 $g(D)$ 或 $g(D)$ 的任意因式整除; 因此, 仅当 $D^{i-j}+1$ 可以被 $g(D)$ 整除时 $e(D)$ 才不会被检测到。对任意的度为 $L$ 的二进制多项式 $g(D)$, 存在最小的 $n$ 使得 $D^n+1$ 可以被 $g(D)$ 整除。根据有限域理论, 这个最小的 $n$ 不能大于 $2^L-1$; 此外, 对所有的 $L>0$, 存在特殊的阶为 $L$ 的多项式 *原始多项式( $primitive$ $polynomial$ )*, 使得这个最小的 $n$ 等于 $2^L-1$。因此, 如果所选的 $g(D)$ 是一个阶为 $L$ 的这样的多项式, 且帧长度被限制到最长 $2^L-1$, 那么 $D^{i-j}$ 就不能被 $g(D)$ 整除; 因此, **所有的两位差错都能够被检出**。

    在实际使用中, 生成多项式 $g(D)$ 常常选用阶为 $L-1$ 的原始多项式和多项式 $D+1$ 的乘积。因为当且仅当 $e(D)$ 包括偶数个非零系数的时候, 多项式 $e(D)$ 才会被 $D+1$ 整除。这确保了**所有的奇数个差错都会被检测到**, 而且原始多项式确保了所有的两个差错都会被检测到(只要所有的帧长度都小于 $2^L-1$)。因此, 所有这种形式的码字都有最小为4的最小距离, 一个至少为L的突发差错检测能力, 以及在完全随机的串中无法检测出差错的概率 $2^{-L}$。长度 $L=16$ 的标准CRC有两个(分别被称为 CRC-16 和 CRC-CCITT)。这些CRC的每一个都是 $D+1$ 和 一个原始的 $(L-1)$ 阶多项式, 并因此都具备上述的性质。还有一个长度 $L=32$ 的标准CRC(即 CRC-32)。他是一个阶为32的原始多项式, 且已经被证明, 对长度小于3007的帧有最小距离5, 对长度小于12,145的帧有最小距离4 [FKL86]。

- 如果传输一个分组中途出错却不能被接收端发现, 算作一次分组层误码。该客户使用本次实验描述的信道, 客户的通信系统每天的使用率是50%, 即：每天只有一半的时间在传输数据, 那么, 根据你对 CRC-32 的检错能力的理解, 发生一次分组层误码事件, 平均需要多少年？

  - 假设当通信系统开启时, 网络层源源不断的产生数据包, 物理层为8000bps, 点到点传输延迟为270ms, 需计算CRC数据长度为259字节, 帧长度263字节, 误码率为 $1\mathrm{e}{-5}$。则当系统运行稳定时, 1093.973秒可收到4060个包。

    由于 $263 * 8 = 2104 < 3007$, 故任意两个帧之间有最小距离5。小于5位的错误都可以被检测到,只需要考虑至少有5位差错的情形。误码率为p, 长度为L位的帧有至少5位差错的概率为
    $$
    p(A) = 1 - \left((1-p)^L+\binom{L}{1}p(1-p)^{L-1}+\binom{L}{2}p^2(1-p)^{L-2}+\binom{L}{3}p^3(1-p)^{L-3}+\binom{L}{4}p^4(1-p)^{L-4}\right)
    \tag{10.1.6}
    $$
    代入数值 $p = 1\mathrm{e}{-5}, L = 2104$, 由于 $\binom{L}{4}p^4(1-p)^{L-4}$ 和其他项都差了至少 $1\mathrm{e}{-5}$ 的数量级, 故忽略此项, 得 $p(A) = 0.00000000800633426223384958575479686260223388671875$ 计算得在约143798万次传输中才会有约99.999%概率出现至少一次不会被检测出的差错, 即至少有5位差错的帧。由于每天只有一半时间传输数据,故计算可得一天可以传输约160721个包, 共需要传输约8947天, 即平均每25年才会出现一次分组层误码事件。

### CRC 校验和的计算方法

### 日志功能

### 可变参数函数

### 定时器函数

### 软件测试

### 流量控制

### 协议改进
